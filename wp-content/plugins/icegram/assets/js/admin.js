jQuery(function(){function e(e){var t=jQuery(e).find(".message_type option:selected").val(),a=jQuery(e).find(".message_row.ig_"+t).find(".message_theme").val(),i=jQuery(e).find(".message_row.ig_"+t).find("#message_form_style").val(),s=jQuery(e).find("#message_theme_ig_"+t).find("."+a).attr("style"),n=jQuery(e).find("#message_form_style").find("."+i).attr("style");jQuery(e).find(".message_row, .location").hide(),jQuery(e).find(".ig_"+t).show(),jQuery(e).find(".message_row.ig_"+t).find(".message_theme").next().find(".chosen-single span").attr("style",s),jQuery(e).find(".message_row.ig_"+t).find(".message_form_style").next().find(".chosen-single span").attr("style",n).text(function(){return jQuery(this).text().substr(0,jQuery(this).text().indexOf(" "))||jQuery(this).text()}),"block"!==jQuery(e).find(".message_body").parent().css("display")?jQuery(e).find(".message_body").parent().next(".wp-editor-wrap").hide():jQuery(e).find(".message_body").parent().next(".wp-editor-wrap").show(),jQuery(e).find(".message_form_layout:checked").is(":visible")||jQuery(e).find(".message_form_layout:visible").first().prop("checked",!0),jQuery(".message_form_layout").change()}function t(e,a,i){var s=Math.floor(Math.random()*(i-a+1))+a;return s==e?t(s,a,i):s}function a(){var e='<span><label class="options_header"><span id="valid-field"> </span></label> <input  type="text" class="url_input_field" data-option="local_url"  name="campaign_target_rules[local_urls][]" value="'+s+'*"/><span class="delete-url"></span></span>';return e}function i(){0==jQuery(".message-row").length?jQuery(".empty_campaign").show():jQuery(".empty_campaign").hide()}var s=icegram_writepanel_params.home_url;jQuery("#campaign_data").find("h3.hndle").hide(),jQuery(".target_rules_desc").appendTo("#campaign_target_rules h3.hndle span"),jQuery(document).ready(function(){var a=window.send_to_editor;jQuery(".color-field").wpColorPicker().each(function(e){var t=jQuery(this).data("color-label")||"";""!==t&&jQuery(this).closest(".wp-picker-container").find("a.wp-color-result").attr("title",t)}),jQuery("#campaign_data, #message-settings").on("change",".show_color_options",function(){jQuery(this).closest("p").next(".message_colors_options_container").toggle(!this.checked)}).change(),i(),jQuery(".message_edit:first").trigger("click"),this_data=jQuery(".message_type option:selected").closest(".message-setting-fields");for(var s=0;s<this_data.length;s++)e(this_data[s]);jQuery(".inside").on("change",".message_type",function(t){var a=jQuery(t.target).parents(".message-setting-fields");e(a)}),jQuery("#campaign_data, #message-settings").on("change",".message_theme",function(e){var t=jQuery(e.target).parents(".message-setting-fields"),a=jQuery(t).find(".message_type").val(),i=jQuery(t).find(".message_row.ig_"+a).find(".message_theme").val(),s=jQuery(t).find("#message_theme_ig_"+a).find("."+i).attr("style");jQuery(t).find(".message_row.ig_"+a).find(".message_theme").next().find(".chosen-single span").attr("style",s)}),jQuery("#campaign_data, #message-settings").on("click",".message_image_button",function(e){var t=this;return window.send_to_editor=function(e){imgurl=jQuery("img",e).attr("src"),jQuery(t).parent().find("#upload_image").val(imgurl),tb_remove(),window.send_to_editor=a},!1}),jQuery("#campaign_data, #message-settings").on("click",".message_headline_button",function(){var e=jQuery(this).prev().attr("data-headline"),a=icegram_writepanel_params.available_headlines.length,i=t(e,0,a),s=icegram_writepanel_params.available_headlines[i];jQuery(this).prev().val(s)}),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip"}),jQuery("span.test_class").hover(function(){jQuery(this).next().show()},function(){jQuery(this).next().hide()}),jQuery("#campaign_data .hndle, #campaign_data .handlediv").unbind("click"),jQuery("#campaign_data .handlediv").hide()}),jQuery("#campaign_data, #message-settings").on("click",".message_delete",function(){jQuery(this).parent().parent().next().remove(),jQuery(this).parent().parent().remove(),i()}),jQuery("#campaign_data, #message-settings").on("click",".message_edit",function(){jQuery(this).parent().parent().next().toggle(),jQuery(this).parent().parent().find(".message-title-text, .message-title-input").toggle()}),jQuery("#campaign_data, #message-settings").on("change",".message-title-input",function(){jQuery(this).prev().text(jQuery(this).val())}),jQuery("select.ajax_chosen_select_messages").ajaxChosen({type:"GET",url:icegram_writepanel_params.ajax_url,dataType:"json",afterTypeDelay:100,data:{action:"icegram_json_search_messages",security:icegram_writepanel_params.search_message_nonce}},function(e){var t={};return jQuery.each(e,function(e,a){t[e]=a}),t}),jQuery("#campaign_data, #message-settings").on("change",".show_form_options",function(e){var t=jQuery(this).closest("p");if(jQuery(t).siblings(".message_form_options").slideToggle(this.checked),this.checked)jQuery(t).siblings(".message_form_options").find(".message_form_layout").change();else{jQuery(t).siblings("p.cta-actions").find("select option").removeAttr("disabled");var a=jQuery(t).siblings(".message_form_options").siblings(".wp-editor-wrap").find(".wp-editor-area"),i=jQuery(a).val().trim().replace("[ig_form]","");jQuery(a).val(i)}}).change(),jQuery("#campaign_data, #message-settings").on("change",".message_form_style",function(e){var t=jQuery(e.target).parents(".message-setting-fields"),a=jQuery(t).find("#message_form_style").val(),i=jQuery(t).find("#message_form_style").find("."+a).attr("style");jQuery(t).find(".message_form_style").next().find(".chosen-single span").attr("style",i).text(function(){return jQuery(this).text().substr(0,jQuery(this).text().indexOf(" "))||jQuery(this).text()})}),jQuery("#campaign_data, #message-settings").on("change",".message_form_layout ",function(){if(jQuery(this).is(":visible")){var e=this,t=jQuery(this).closest(".message_form_options").siblings(".wp-editor-wrap").find(".wp-editor-area"),a=jQuery(t).val().trim();jQuery(e).closest(".form_radio_group").siblings(".form_inline_shortcode").hide(),jQuery(e).closest(".form_radio_group").siblings(".message_form_color").show(),jQuery(e).is(":checked")&&jQuery(e).closest(".message_form_options").prev("p.message_form_options_check").find(".show_form_options").is(":checked")&&("inline"==jQuery(e).val()?(-1==a.indexOf("[ig_form]")&&(a+="[ig_form]"),jQuery(e).closest(".form_radio_group").siblings(".message_form_color, .form_inline_shortcode").toggle()):"inline"!=jQuery(e).val()&&(a=a.replace("[ig_form]",""))),jQuery(t).val(a)}}),jQuery("#campaign_data, #message-settings").on("blur",".message_form_html_original",function(e){var t=this,a=jQuery("<div/>").html(jQuery(t).val()).find("input[type=submit], button, input[type=button]").not("*:disabled"),i=jQuery(t).closest(".message_form_options");if(jQuery(i).parent().find("p.cta-actions select option").removeAttr("disabled"),void 0!=jQuery(t).val()&&""!=jQuery(t).val()&&jQuery(i).parent().find("p.cta-actions select").find('option[value="url"], option[value="hide"], option[value="cta_another_message"]').attr("disabled",!0).attr("selected",!1).end().find('option[value="form"]').attr("selected",!0).trigger("change"),a.length>0){var s=jQuery(a[a.length-1]),n=s.is("button")?s.not("br, span, div").text():s.val();jQuery(i).siblings("p").find("#message_label").val(n.trim())}}),jQuery(".ajax_chosen_select_messages").chosen(),jQuery("#campaign_data, #message-settings").on("change",".ajax_chosen_select_messages",function(){var t={},a=jQuery("#ig-st-tabs li.current").attr("variation_id");"undefined"!=typeof a&&jQuery.extend(t,{selected_tab:a});var s=jQuery.extend({},tinyMCEPreInit.mceInit.content),n=jQuery.extend({},tinyMCEPreInit.qtInit.content),r=jQuery(this).parent().siblings(".campaign_target_rules_panel");"undefined"!=typeof r&&(t.parent_campaign_box=r);var o=jQuery(r).find(".message-row").length,u=jQuery(this).val();return""==u?void jQuery(".ajax_chosen_select_messages").val("").trigger("chosen:updated"):(jQuery(".message-edit-row").hide(),jQuery(".message-title-text").show(),jQuery(".message-title-input").hide(),void jQuery.ajax({type:"POST",url:icegram_writepanel_params.ajax_url,dataType:"json",data:{action:"get_message_action_row",message_id:u,row:o},success:function(a){if(o++,jQuery(r).find(".messages-list .messages_list_table tbody").append(a.main),jQuery(".color-field").wpColorPicker().each(function(e){var t=jQuery(this).data("color-label")||"";""!==t&&jQuery(this).closest(".wp-picker-container").find("a.wp-color-result").attr("title",t)}),jQuery("#campaign_data, #message-settings").on("change",".show_color_options",function(){jQuery(this).closest("p").next(".message_colors_options_container").toggle(!this.checked)}).change(),e(jQuery("#"+a.id)),jQuery(".ajax_chosen_select_messages").val("").trigger("chosen:updated"),jQuery("#campaign_data, #message-settings").find(".message_theme").append('<option value="ig_get_more_theme" class="ig_get_more">Get more Themes</option>'),jQuery("#campaign_data, #message-settings").find(".message_animation").append('<option value="ig_get_more_animation" class="ig_get_more">Get more Animations</option>'),jQuery("select.icegram_chosen_page").chosen({disable_search_threshold:10}),i(),jQuery(".message-setting-fields").trigger("change"),jQuery(".tips, .help_tip").tipTip({attribute:"data-tip"}),"undefined"==typeof tinyMCEPreInit.mceInit["edit"+a.id]){for(_prop in s)"string"==typeof s[_prop]&&"content_css"!==_prop&&(s[_prop]=s[_prop].replace(new RegExp("content","g"),"edit"+a.id));tinyMCEPreInit.mceInit["edit"+a.id]=s}if("undefined"==typeof tinyMCEPreInit.qtInit["edit"+a.id]){for(_prop in n)"string"==typeof n[_prop]&&"content_css"!==_prop&&(n[_prop]=n[_prop].replace(new RegExp("content","g"),"edit"+a.id));tinyMCEPreInit.qtInit["edit"+a.id]=n}tinyMCE.init({id:tinyMCEPreInit.mceInit["edit"+a.id]}),quicktags({id:"edit"+a.id}),QTags._buttonsInit(),jQuery("#wp-edit"+a.id+"-wrap").hasClass("tmce-active")?jQuery("#edit"+a.id+"-tmce").click():jQuery("#edit"+a.id+"-html").click(),jQuery(window).trigger("icegram_message_added_ajax",[t])}}))}),jQuery("#campaign_target_rules").on("click","#add_local_url_row",function(e){e.preventDefault();var t=a();jQuery(".local_url").find(".url_input_field").length?jQuery(t).insertAfter(jQuery(".local_url").find(".url_input_field").last().parent("span")):jQuery(t).insertBefore(jQuery(".local_url").find("#add_local_url_row_label"))}),jQuery("#campaign_target_rules").on("click",".delete-url",function(e){jQuery(this).parent().remove()}),jQuery("select.ajax_chosen_select_messages").next("div").on("click","div.chosen-drop",function(){jQuery(this).closest("h3.hndle").trigger("click")}),jQuery("#campaign_data").on("click",".campaign_preview",function(e){jQuery(this).closest("h3.hndle").trigger("click"),0!=jQuery(".message-row").length&&(tinyMCE.triggerSave(),params=jQuery("#post").serializeArray(),params.push({name:"action",value:"save_campaign_preview"}),jQuery.ajax({type:"POST",async:!1,url:icegram_writepanel_params.ajax_url,data:params,success:function(e){""!=e&&window.open(e,"preview_window")}}))}),jQuery("#campaign_data, #message-settings").find(".message_theme").append('<option value="ig_get_more_theme" class="ig_get_more">Get more themes</option>'),jQuery("#campaign_data, #message-settings").find(".message_animation").append('<option value="ig_get_more_animation" class="ig_get_more">Get more Animations</option>'),jQuery("#campaign_data, #message-settings").on("change",".message_theme, .message_animation",function(){"ig_get_more_theme"==jQuery(this).val()&&window.open("http://www.icegram.com/product-category/themes-addons/?utm_source=icegram&utm_medium=admin&utm_campaign=theme_packs"),"ig_get_more_animation"==jQuery(this).val()&&window.open("http://www.icegram.com/addons/icegram-animation-pack/?utm_source=icegram&utm_medium=admin&utm_campaign=animation_pack")}),jQuery("select.icegram_chosen_page").chosen({disable_search_threshold:10}),jQuery("input#users_logged_in, input#users_all ,input#users_not_logged_in").on("change",function(){"logged_in"==jQuery(this).val()?(jQuery("select#users_roles").parent("p").show(),jQuery("#users_roles_chosen").find("input").trigger("click")):jQuery("select#users_roles").parent("p").hide()}),jQuery(".schedule_rule").on("change",function(){"when_schedule"==jQuery(this).attr("id")?jQuery("#date_picker").show():jQuery("#date_picker").hide()}),jQuery("input#where_other_page").on("change",function(){jQuery("select#where_page_id").parent("p").slideToggle(),jQuery(this).is(":checked")&&jQuery("#where_page_id_chosen").find("input").trigger("click")}),jQuery("input#where_sitewide").on("change",function(){jQuery("select#exclude_page_id").parent("p").slideToggle(),jQuery(this).is(":checked")&&jQuery("#exclude_page_id_chosen").find("input").trigger("click")}),jQuery("input#where_local_url").on("change",function(){jQuery(".local_url").slideToggle()}),jQuery(".date-picker").datepicker({dateFormat:"yy-mm-dd",defaultDate:0,showOtherMonths:!0,selectOtherMonths:!0,changeMonth:!0,changeYear:!0,showButtonPanel:!0}),jQuery("#campaign_target_rules").on("focusout","input.url_input_field",function(){var e=this;if(jQuery(e).parent().find("span#valid-field").removeClass("error"),"undefine"!==jQuery(e).data("option")&&"local_url"==jQuery(e).data("option")&&"*"!=jQuery(e).val()){var t=e.value;if(t.indexOf(s)<0)return void jQuery(e).val(s+t)}})});