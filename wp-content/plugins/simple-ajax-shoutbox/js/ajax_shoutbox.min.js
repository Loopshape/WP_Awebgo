jQuery(document).ready(function(a){function l(b,c){if(!p&&h)clearInterval(h),h=0;else{var d=a("#"+b);if(!d.data("lock")||c){var v=b.substring(b.lastIndexOf("-")+1);a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_refresh",m:a(d).data("msgTotal"),id:v},beforeSend:function(){a(".icons .spinner",d).css("display","inline-block")},error:function(){a("div#sb_messages",d).data("ajaxData","").html("<div class='error_message' align='center'>"+SimpleAjaxShoutbox.request_error_text+"</div>")},success:function(b){b!=a("div#sb_messages",d).data("ajaxData")&&(a("div#sb_messages",d).data("ajaxData",b).html(b),q(),r())},complete:function(){a(".icons .spinner",d).fadeOut("slow");a(d).data("msgAddLock",0)}})}}}function q(b){void 0===b&&(b=".sb_message_body > a > img");try{"function"==typeof a.fn.lightbox?a(b).parent().attr("rel","lightbox").lightbox({title:function(){return a(this).children().attr("alt")}}):a.colorbox?a(b).parent().colorbox({title:function(){return a(this).children().attr("alt")},maxWidth:"100%",maxHeight:a(window).height()-2*(a("#wpadminbar").height()||0)}):"function"==typeof a.fn.fancybox?a(b).parent().fancybox({title:function(){return a(this).children().attr("alt")}}):"undefined"!==typeof Shadowbox?Shadowbox.setup(a(b).parent().get(),[]):"function"==typeof doLightBox&&(a(b).parent().attr("rel","lightbox"),doLightBox())}catch(c){}}function f(a){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;"hidden"==(a.type in c?c[a.type]:this[g]?"hidden":"visible")?p=!1:(p=!0,h||(h=setInterval(function(){l(n)},t),l(n)))}function w(a,c){if(document.selection)a.focus(),sel=document.selection.createRange(),sel.text=c;else if(a.selectionStart||"0"==a.selectionStart){var d=a.selectionEnd;a.value=a.value.substring(0,a.selectionStart)+c+a.value.substring(d,a.value.length)}else a.value+=c}function r(b){var c=".sb_message_header .menu";b&&(c="#sb_message_"+b+" "+c);a(c).each(function(){a(this).append('<span class="commands"></span><span class="infos"></span>');a(this).find(".command").appendTo(a(this).find(".commands"));a(this).find(".info").appendTo(a(this).find(".infos"))})}function x(){u=!1;e=0;a("#sb-reply").hide()}var m="placeholder"in document.createElement("input");SimpleAjaxShoutbox=a.extend({},{ajaxurl:window.location.origin+"/wp-admin/admin-ajax.php",reload_time:"30",max_messages:"20",max_msglen:"255",request_error_text:"Request error",max_msglen_error_text:"Max length of message is %maxlength% characters, length of your message is %length% characters. Please shorten it.",name_empty_error_text:"Name empty.",msg_empty_error_text:"Message empty.",delete_message_text:"Delete this message?"},SimpleAjaxShoutbox);var p=!0;a("body").on("click",".sb_message_header .menu .delete",function(b){b.preventDefault();var c=a(this).parents(".Ajax_Shoutbox_Widget");b=a(this).parents(".sb_message").attr("id");b=b.substring(b.lastIndexOf("_")+1);if(!confirm(SimpleAjaxShoutbox.delete_message_text))return!1;a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_delete_message",m_id:b,_ajax_nonce:a("data#nonce",c).attr("value")},success:function(b,v){0<parseInt(b)&&a("div#sb_message_"+b,c).slideUp("slow",function(){a(this).remove()});a("#sb_message",c).val("")}})});q();var h=0,n,t;a(".Ajax_Shoutbox_Widget").each(function(b){function c(b){b&&b.preventDefault();var c=a("#"+d);b=parseInt(SimpleAjaxShoutbox.max_msglen);if(a("#sb_message",c).val().length>b)b=SimpleAjaxShoutbox.max_msglen_error_text.replace("%length%",a("#sb_message").val().length).replace("%maxlength%",b),alert(b);else{m||c.parents("form").find("[placeholder]").each(function(){var b=a(this);b.val()==b.attr("placeholder")&&b.val("")});b=a("input#sb_name",c).val();var k=a("input#sb_website",c).val(),e=a("#sb_message",c).val();if(""==b)alert(SimpleAjaxShoutbox.name_empty_error_text),m||a("#sb_form [placeholder]",c).blur();else if(""==e)alert(SimpleAjaxShoutbox.msg_empty_error_text),m||a("#sb_form [placeholder]",c).blur();else{a("#sb_form .spinner",c).css("display","inline-block");a("#sb_addmessage",c).addClass("disabled");var f=d.substring(d.lastIndexOf("-")+1);a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_add_message",user:b,message:e,website:k,id:f},success:function(b){a("div#sb_messages",c).prepend(b).show("slow");b=b.match(/sb_message_(\d+)/);q("#sb_message_"+b[1]+" .sb_message_body > a > img");r(b[1]);a("#sb_message",c).val("");m||a("#sb_form [placeholder]",c).blur();a("#sb_addmessage",c).removeClass("disabled");a("#sb_form .spinner",c).fadeOut("slow")},error:function(a){}})}}}var d=a(this).data("lock",0).data("msgAddLock",0).data("msgTotal",SimpleAjaxShoutbox.max_messages).attr("id");n=d;t=1E3*parseInt(SimpleAjaxShoutbox.reload_time);h=setInterval(function(){l(n)},t);a("#sb_smiles .wp-smiley",this).click(function(b){b=a(this).parents(".Ajax_Shoutbox_Widget").find("#sb_form #sb_message")[0];w(b,a(this).attr("title"));b.focus()});a("div#sb_messages",this).scroll(function(){var b=a("#"+d),c=a(this),e=5<c.scrollTop();b.data("lock",e);a(".icons .lock",b).toggle(e);!b.data("msgAddLock")&&c[0].scrollHeight-c.scrollTop()<=c.outerHeight()&&(b.data("msgAddLock",1).data("msgTotal",parseInt(b.data("msgTotal"))+parseInt(SimpleAjaxShoutbox.max_messages)),l(d,!0))});a("#sb_addmessage",this).click(c);a("#sb_message",this).keydown(function(a){10!=a.keyCode&&13!=a.keyCode||!a.ctrlKey||c()});l(d)});a("div#sb_messages").mouseover(function(){a("span#sb_status").html("")});a("#sb_showsmiles").click(function(){a("div#sb_smiles").fadeIn("slow")});m||(a("#sb_form [placeholder]").focus(function(){var b=a(this);b.val()==b.attr("placeholder")&&(b.val(""),b.removeClass("sb_placeholder"))}).blur(function(){var b=a(this);if(""==b.val()||b.val()==b.attr("placeholder"))b.addClass("sb_placeholder"),b.val(b.attr("placeholder"))}).blur(),a("#sb_form [placeholder]").parents("form").submit(function(){a(this).find("[placeholder]").each(function(){var b=a(this);b.val()==b.attr("placeholder")&&b.val("")})}));a("body").on("click",".sb_message_body .youtube-embed-video .play-button",function(b){b.preventDefault();b="https://www.youtube.com/embed/"+a(this).attr("rel")+"?autoplay=1";var c=a(window).width(),d=a(window).height(),e=16/9;640<=c?c/e>d?(c*=.9,d=c/e):(d*=.9,c=d*e):d=c/e;a.colorbox?a.colorbox({width:c+44,height:d+70,iframe:!0,href:b}):"function"==typeof a.fn.fancybox?a(this).addClass("iframe").attr("href",b).fancybox().click():"undefined"!==typeof Shadowbox?Shadowbox.open({content:b,type:"iframe",player:"iframe",width:c,height:d}):320>a(this).parents(".youtube-embed-wrapper").width()?window.open(b,"YouTube","width=640,height=360"):a(this).parents(".youtube-embed-wrapper").replaceWith('<iframe width="100%" height="'+360*a(this).parents(".youtube-embed-wrapper").width()/640+'" src="'+b+'"></iframe>')});var g="hidden";g in document?document.addEventListener("visibilitychange",f):(g="mozHidden")in document?document.addEventListener("mozvisibilitychange",f):(g="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",f):(g="msHidden")in document?document.addEventListener("msvisibilitychange",f):"onfocusin"in document?document.onfocusin=document.onfocusout=f:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=f;void 0!==document[g]&&f({type:document[g]?"blur":"focus"});r();a("body").on("click",".sb_message_header .menu .reply",function(b){b.preventDefault();b=a(this).parents(".sb_message").attr("id").substring(11);a(this).parents(".sb_message").find(".username").text();b="{reply "+b+"} ";var c=a(this).parents(".Ajax_Shoutbox_Widget").find("#sb_form #sb_message")[0];w(c,b);c.focus()});a("body").append('<div id="sb-reply">Reply</div>');var u=!1,e=0;a("body").on("mouseenter",".sb_message_body .reply",function(b){e&&(clearTimeout(e),e=0);var c=a(this).parents(".Ajax_Shoutbox_Widget");b=c.attr("id");b=b.substring(b.lastIndexOf("-")+1);var d=a(this).offset().top+a(this).height(),f=a(this).parents(".sb_message_body").offset().left,g=a(this).parents(".sb_message_body").width(),k=a(this).attr("rel"),h=c.find("#sb_message_"+k);u=!0;a("#sb-reply").attr("rel")==k?a("#sb-reply").css("top",d).css("left",f).css("width",g).show():0<h.length?a("#sb-reply").html(h.html()).attr("rel",k).css("top",d).css("left",f).css("width",g).show():a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_single",m_id:k,id:b},beforeSend:function(){a(".icons .spinner",c).css("display","inline-block")},success:function(b,c){""!=b&&a("#sb-reply").html(b).attr("rel",k).css("top",d).css("left",f).css("width",g);u&&a("#sb-reply").show()},complete:function(){a(".icons .spinner",c).fadeOut("slow")}})}).on("mouseleave",".sb_message_body .reply",function(a){e=setTimeout(function(){x()},100)});a("body").on("mouseenter","#sb-reply",function(a){e&&(clearTimeout(e),e=0)}).on("mouseleave","#sb-reply",function(a){x()})});