jQuery(document).ready(function(a){function m(b,c){var e=a("#"+b);if(t||a(".icons .speaker",e).hasClass("active")||!k){var n=a("div#sb_messages",e);if(!e.data("lock")||c){var d=b.substring(b.lastIndexOf("-")+1);a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_refresh",m:a(e).data("msgTotal"),id:d},beforeSend:function(){a(".icons .spinner",e).css("display","inline-block")},error:function(){n.data("ajaxData","").html("<div class='error_message' align='center'>"+SimpleAjaxShoutbox.request_error_text+"</div>")},success:function(b){n.after('<div style="display:none" id="msgs_placeholder"></div>');var c=a("#msgs_placeholder",e);c.html(b);b=c.children().last();for(var d=n.children().last(),q,l,f,g=!1;0<b.length;){l=b.attr("id");for(l=l.substring(l.lastIndexOf("_")+1);0<d.length;){f=d.attr("id");f=f.substring(f.lastIndexOf("_")+1);if(l<=f)break;q=d;d=d.prev();q.slideUp(function(){a(this).remove()})}l==f?(b.attr("hash")!=d.attr("hash")&&d.html(b.html()),d=d.prev()):(0==d.length?(n.prepend(b.hide()[0].outerHTML).children().first().slideDown(),g=!0):d.after(b[0].outerHTML),u("div#sb_messages #sb_message_"+l+" .sb_message_body > a > img"),v(l));b=b.prev()}for(;0<d.length;)q=d,d=d.prev(),q.slideUp(function(){a(this).remove()});c.remove();a(".icons .speaker",e);g&&a(".icons .speaker",e).hasClass("active")&&a("audio#notify",e)[0].play()},complete:function(){a(".icons .spinner",e).fadeOut("slow");a(e).data("msgAddLock",0)}})}}else clearInterval(k),k=0}function u(b){void 0===b&&(b=".sb_message_body > a > img");try{"function"==typeof a.fn.lightbox?a(b).parent().attr("rel","lightbox").lightbox({title:function(){return a(this).children().attr("alt")}}):a.colorbox?a(b).parent().colorbox({title:function(){return a(this).children().attr("alt")},maxWidth:"100%",maxHeight:a(window).height()-2*(a("#wpadminbar").height()||0)}):"function"==typeof a.fn.fancybox?a(b).parent().fancybox({title:function(){return a(this).children().attr("alt")}}):"undefined"!==typeof Shadowbox?Shadowbox.setup(a(b).parent().get(),[]):"function"==typeof doLightBox&&(a(b).parent().attr("rel","lightbox"),doLightBox())}catch(c){}}function g(a){var c={focus:"visible",focusin:"visible",pageshow:"visible",blur:"hidden",focusout:"hidden",pagehide:"hidden"};a=a||window.event;"hidden"==(a.type in c?c[a.type]:this[h]?"hidden":"visible")?t=!1:(t=!0,k||(k=setInterval(function(){m(r)},w),m(r)))}function y(a,c){if(document.selection)a.focus(),sel=document.selection.createRange(),sel.text=c;else if(a.selectionStart||"0"==a.selectionStart){var e=a.selectionEnd;a.value=a.value.substring(0,a.selectionStart)+c+a.value.substring(e,a.value.length)}else a.value+=c}function v(b){var c=".sb_message_header .menu";b&&(c="#sb_message_"+b+" "+c);a(c).each(function(){a(this).append('<span class="commands"></span><span class="infos"></span>');a(this).find(".command").appendTo(a(this).find(".commands"));a(this).find(".info").appendTo(a(this).find(".infos"))})}function z(){x=!1;f=0;a("#sb-reply").hide()}var p="placeholder"in document.createElement("input");SimpleAjaxShoutbox=a.extend({},{ajaxurl:window.location.origin+"/wp-admin/admin-ajax.php",reload_time:"30",max_messages:"20",max_msglen:"255",request_error_text:"Request error",max_msglen_error_text:"Max length of message is %maxlength% characters, length of your message is %length% characters. Please shorten it.",name_empty_error_text:"Name empty.",msg_empty_error_text:"Message empty.",delete_message_text:"Delete this message?"},SimpleAjaxShoutbox);var t=!0;a("body").on("click",".sb_message_header .menu .delete",function(b){b.preventDefault();var c=a(this).parents(".Ajax_Shoutbox_Widget");b=a(this).parents(".sb_message").attr("id");b=b.substring(b.lastIndexOf("_")+1);if(!confirm(SimpleAjaxShoutbox.delete_message_text))return!1;a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_delete_message",m_id:b,_ajax_nonce:a("data#nonce",c).attr("value")},success:function(b,n){0<parseInt(b)&&a("div#sb_message_"+b,c).slideUp("slow",function(){a(this).remove()});a("#sb_message",c).val("")}})});u();var k=0,r,w;a(".Ajax_Shoutbox_Widget").each(function(b){function c(b){b&&b.preventDefault();var d=a("#"+e);b=parseInt(SimpleAjaxShoutbox.max_msglen);if(a("#sb_message",d).val().length>b)b=SimpleAjaxShoutbox.max_msglen_error_text.replace("%length%",a("#sb_message").val().length).replace("%maxlength%",b),alert(b);else{p||d.parents("form").find("[placeholder]").each(function(){var b=a(this);b.val()==b.attr("placeholder")&&b.val("")});b=a("input#sb_name",d).val();var c=a("input#sb_website",d).val(),f=a("#sb_message",d).val();if(""==b)alert(SimpleAjaxShoutbox.name_empty_error_text),p||a("#sb_form [placeholder]",d).blur();else if(""==f)alert(SimpleAjaxShoutbox.msg_empty_error_text),p||a("#sb_form [placeholder]",d).blur();else{a("#sb_form .spinner",d).css("display","inline-block");a("#sb_addmessage",d).addClass("disabled");var g=e.substring(e.lastIndexOf("-")+1);a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_add_message",user:b,message:f,website:c,id:g},success:function(b){var c=b.match(/sb_message_(\d+)/);0==a("div#sb_messages #sb_message_"+c[1],d).length&&(b=b.replace('id="sb_message_','style="display:none" id="sb_message_'),a("div#sb_messages",d).prepend(b),a("div#sb_messages #sb_message_"+c[1],d).slideDown(),u("#sb_message_"+c[1]+" .sb_message_body > a > img"),v(c[1]));a("#sb_message",d).val("");p||a("#sb_form [placeholder]",d).blur()},error:function(a){},complete:function(){a("#sb_addmessage",d).removeClass("disabled");a("#sb_form .spinner",d).fadeOut("slow")}})}}}var e=a(this).data("lock",0).data("msgAddLock",0).data("msgTotal",SimpleAjaxShoutbox.max_messages).attr("id");r=e;w=1E3*parseInt(SimpleAjaxShoutbox.reload_time);k=setInterval(function(){m(r)},w);a("#sb_smiles .wp-smiley",this).click(function(b){b=a(this).parents(".Ajax_Shoutbox_Widget").find("#sb_form #sb_message")[0];y(b,a(this).attr("title"));b.focus()});a("div#sb_messages",this).scroll(function(){var b=a("#"+e),c=a(this),f=5<c.scrollTop();b.data("lock",f);a(".icons .lock",b).toggle(f);!b.data("msgAddLock")&&c[0].scrollHeight-c.scrollTop()<=c.outerHeight()&&(b.data("msgAddLock",1).data("msgTotal",parseInt(b.data("msgTotal"))+parseInt(SimpleAjaxShoutbox.max_messages)),m(e,!0))});a("#sb_addmessage",this).click(c);a("#sb_message",this).keydown(function(a){10!=a.keyCode&&13!=a.keyCode||!a.ctrlKey||c()});m(e)});a("div#sb_messages").mouseover(function(){a("span#sb_status").html("")});a("#sb_showsmiles").click(function(){a("div#sb_smiles").fadeIn("slow")});a(".Ajax_Shoutbox_Widget .icons .speaker").click(function(){a(this).toggleClass("active");document.cookie="shoutbox_speaker="+(a(this).hasClass("active")?"true":"false")+"; expires=Fri, 31 Dec 9999 23:59:59 GMT; path=/"});p||(a("#sb_form [placeholder]").focus(function(){var b=a(this);b.val()==b.attr("placeholder")&&(b.val(""),b.removeClass("sb_placeholder"))}).blur(function(){var b=a(this);if(""==b.val()||b.val()==b.attr("placeholder"))b.addClass("sb_placeholder"),b.val(b.attr("placeholder"))}).blur(),a("#sb_form [placeholder]").parents("form").submit(function(){a(this).find("[placeholder]").each(function(){var b=a(this);b.val()==b.attr("placeholder")&&b.val("")})}));a("body").on("click",".sb_message_body .youtube-embed-video .play-button",function(b){b.preventDefault();b="https://www.youtube.com/embed/"+a(this).attr("rel")+"?autoplay=1";var c=a(window).width(),e=a(window).height(),f=16/9;640<=c?c/f>e?(c*=.9,e=c/f):(e*=.9,c=e*f):e=c/f;a.colorbox?a.colorbox({width:c+44,height:e+70,iframe:!0,href:b}):"function"==typeof a.fn.fancybox?a(this).addClass("iframe").attr("href",b).fancybox().click():"undefined"!==typeof Shadowbox?Shadowbox.open({content:b,type:"iframe",player:"iframe",width:c,height:e}):320>a(this).parents(".youtube-embed-wrapper").width()?window.open(b,"YouTube","width=640,height=360"):a(this).parents(".youtube-embed-wrapper").replaceWith('<iframe width="100%" height="'+360*a(this).parents(".youtube-embed-wrapper").width()/640+'" src="'+b+'"></iframe>')});var h="hidden";h in document?document.addEventListener("visibilitychange",g):(h="mozHidden")in document?document.addEventListener("mozvisibilitychange",g):(h="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",g):(h="msHidden")in document?document.addEventListener("msvisibilitychange",g):"onfocusin"in document?document.onfocusin=document.onfocusout=g:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=g;void 0!==document[h]&&g({type:document[h]?"blur":"focus"});v();a("body").on("click",".sb_message_header .menu .reply",function(b){b.preventDefault();b=a(this).parents(".sb_message").attr("id").substring(11);a(this).parents(".sb_message").find(".username").text();b="{reply "+b+"} ";var c=a(this).parents(".Ajax_Shoutbox_Widget").find("#sb_form #sb_message")[0];y(c,b);c.focus()});a("body").append('<div id="sb-reply">Reply</div>');var x=!1,f=0;a("body").on("mouseenter",".sb_message_body .reply",function(b){f&&(clearTimeout(f),f=0);var c=a(this).parents(".Ajax_Shoutbox_Widget");b=c.attr("id");b=b.substring(b.lastIndexOf("-")+1);var e=a(this).offset().top+a(this).height(),g=a(this).parents(".sb_message_body").offset().left,d=a(this).parents(".sb_message_body").width(),h=a(this).attr("rel"),k=c.find("#sb_message_"+h);x=!0;a("#sb-reply").attr("rel")==h?a("#sb-reply").css("top",e).css("left",g).css("width",d).show():0<k.length?a("#sb-reply").html(k.html()).attr("rel",h).css("top",e).css("left",g).css("width",d).show():a.ajax({url:SimpleAjaxShoutbox.ajaxurl,type:"POST",cache:!1,data:{action:"shoutbox_single",m_id:h,id:b},beforeSend:function(){a(".icons .spinner",c).css("display","inline-block")},success:function(b,c){""!=b&&a("#sb-reply").html(b).attr("rel",h).css("top",e).css("left",g).css("width",d);x&&a("#sb-reply").show()},complete:function(){a(".icons .spinner",c).fadeOut("slow")}})}).on("mouseleave",".sb_message_body .reply",function(a){f=setTimeout(function(){z()},100)});a("body").on("mouseenter","#sb-reply",function(a){f&&(clearTimeout(f),f=0)}).on("mouseleave","#sb-reply",function(a){z()})});